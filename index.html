<!DOCTYPE html>
<html>

<head>
  <title>WebGPU WGSL Shader Playground</title>
  <!-- CodeMirror CSS (load before scripts) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="container">
    <div id="editor-panel">
      <div id="editor-header">
        <div>
          <span>WGSL Shader Editor</span>
        </div>
        <div id="mode-controls">
          <span class="mode-label">Base:</span>
          <select id="mode-select" class="mode-select">
            <option value="triangle">Triangle</option>
            <option value="quad">Full-Screen Quad (SDF)</option>
            <option value="texture">Procedural Pattern</option>
            <option value="interactive">Interactive Controls Demo</option>
          </select>
        </div>
        <!-- Updated Right Side: Settings + Run Info -->
        <div style="display: flex; align-items: center; gap: 10px;">
          <button id="settings-btn" class="icon-btn" title="Settings">
            <i class="fas fa-cog"></i>
          </button>
          <span id="run-info">Cmd/Ctrl+Enter to run</span>
        </div>
      </div>
      <div id="save-controls">
        <button id="new-shader-btn">New</button>
        <label style="margin-left: 10px;">Save:</label>
        <input type="text" id="shader-name" placeholder="Enter shader name..." />
        <button id="save-shader-btn" class="primary">Save</button>
        <button id="update-shader-btn" class="primary" style="display: none;">Update</button>
        <label style="margin-left: 10px;">Load:</label>
        <select id="saved-shaders">
          <option value="">-- Select saved shader --</option>
        </select>
        <button id="load-shader-btn">Load</button>
        <button id="delete-shader-btn">Delete</button>
        <label style="margin-left: 10px;">Backup:</label>
        <button id="export-shaders-btn">Export All</button>
        <button id="import-shaders-btn">Import</button>
        <input type="file" id="import-file-input" accept=".json" style="display: none;" />
      </div>
      <div id="editor-wrapper">
        <textarea id="shader-editor"></textarea>
      </div>
      <div id="error-display"></div>
    </div>
    <div id="resizer"></div>
    <div id="canvas-panel">
      <div id="canvas-header">
        <span>WebGPU Output</span>
        <div style="display: flex; align-items: center; gap: 15px;">
          <div id="timer-controls" style="display: flex; align-items: center; gap: 5px;">
            <button id="pause-timer-btn" class="icon-btn" title="Pause/Resume Timer">
              <i class="fas fa-pause"></i>
            </button>
            <button id="reset-timer-btn" class="icon-btn" title="Reset Timer">
              <i class="fas fa-undo"></i>
            </button>
          </div>
          <button id="custom-data-btn" class="icon-btn" title="Custom Data">
            <i class="fas fa-database"></i>
          </button>
          <button id="toggle-inputs-btn" class="icon-btn" title="Toggle Custom Inputs" style="display: none;">
            <i class="fas fa-sliders-h"></i>
          </button>
          <span id="fps-display">FPS: --</span>
          <span id="uniforms-info">Uniforms: u.resolution, u.time, u.frame, u.mouse, u.mouseDown | Custom Data: uniforms & textures | Base: triangle, quad, procedural, interactive</span>
        </div>
      </div>
      <div id="custom-inputs-container" style="display: none;">
        <div id="custom-inputs-area" class="custom-inputs-area">
          <!-- Custom inputs will be rendered here -->
        </div>
      </div>
      <div id="canvas-wrapper">
        <canvas id="canvas"></canvas>
      </div>
    </div>
  </div>

  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <span class="close-modal">&times;</span>
      </div>

      <div class="setting-group">
        <h3>Rendering</h3>
        <div class="setting-item">
          <label for="clear-color">Clear Color (Background)</label>
          <div class="color-picker-wrapper">
            <input type="color" id="clear-color" value="#1a1a1a">
            <span id="clear-color-hex">#1a1a1a</span>
          </div>
        </div>
        <div class="setting-item">
          <label for="resolution-scale">Resolution Scale</label>
          <select id="resolution-scale">
            <option value="0.25">0.25x (Performance)</option>
            <option value="0.5">0.5x (Balanced)</option>
            <option value="1.0" selected>1.0x (Native)</option>
            <option value="2.0">2.0x (High DPI)</option>
          </select>
        </div>
      </div>

      <div class="setting-group">
        <h3>Editor</h3>
        <div class="setting-item">
          <label for="font-size">Font Size (px)</label>
          <input type="number" id="font-size" value="13" min="10" max="24">
        </div>
        <div class="setting-item">
          <label for="word-wrap" class="checkbox-label">
            <span>Word Wrap</span>
            <input type="checkbox" id="word-wrap">
          </label>
        </div>
      </div>

      <div class="setting-group">
        <h3>Display</h3>
        <div class="setting-item">
          <label for="show-fps" class="checkbox-label">
            <span>Show FPS Counter</span>
            <input type="checkbox" id="show-fps">
          </label>
        </div>
      </div>
    </div>
  </div>

  <div id="custom-data-modal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2>Custom Data</h2>
        <span class="close-modal">&times;</span>
      </div>

      <div class="custom-data-content">
        <div class="data-section">
          <h3>Custom Uniforms</h3>
          <div class="uniform-controls">
            <div class="uniform-input-group">
              <input type="text" id="uniform-name" placeholder="Uniform name (e.g., myColor)" />
              <select id="uniform-type">
                <option value="f32">float (f32)</option>
                <option value="vec2<f32>">vec2 (vec2<f32>)</option>
                <option value="vec3<f32>">vec3 (vec3<f32>)</option>
                <option value="vec4<f32>">vec4 (vec4<f32>)</option>
                <option value="i32">int (i32)</option>
                <option value="vec2<i32>">ivec2 (vec2<i32>)</option>
                <option value="vec3<i32>">ivec3 (vec3<i32>)</option>
                <option value="vec4<i32>">ivec4 (vec4<i32>)</option>
                <option value="u32">uint (u32)</option>
                <option value="vec2<u32>">uvec2 (vec2<u32>)</option>
                <option value="vec3<u32>">uvec3 (vec3<u32>)</option>
                <option value="vec4<u32>">uvec4 (vec4<u32>)</option>
                <option value="bool">bool</option>
                <option value="vec2<bool>">bvec2 (vec2<bool>)</option>
                <option value="vec3<bool>">bvec3 (vec3<bool>)</option>
                <option value="vec4<bool>">bvec4 (vec4<bool>)</option>
              </select>
              <input type="text" id="uniform-value" placeholder="Value (e.g., 1.0 or vec3(1.0, 0.5, 0.0))" />
              <button id="add-uniform-btn">Add</button>
            </div>
          </div>
          <div id="uniforms-list" class="uniforms-list">
            <!-- Uniforms will be listed here -->
          </div>
        </div>

        <div class="data-section">
          <h3>Textures</h3>
          <div class="texture-controls">
            <input type="file" id="texture-upload" accept="image/*" multiple style="display: none;" />
            <button id="upload-texture-btn">Upload Texture</button>
          </div>
          <div id="textures-list" class="textures-list">
            <!-- Textures will be listed here -->
          </div>
        </div>

        <div class="data-section">
          <h3>Custom Inputs</h3>
          <div class="input-controls">
            <div class="input-input-group">
              <input type="text" id="input-label" placeholder="Input label (e.g., Speed)" />
              <input type="text" id="input-uniform" placeholder="Uniform name (e.g., speed)" />
              <select id="input-type">
                <option value="slider">Slider</option>
                <option value="button">Button</option>
                <option value="number">Number Input</option>
                <option value="text">Text Input</option>
              </select>
              <button id="add-input-btn">Add Input</button>
            </div>
            <div id="input-config" class="input-config" style="display: none;">
              <!-- Dynamic config options will appear here based on input type -->
            </div>
          </div>
          <div id="inputs-list" class="inputs-list">
            <!-- Custom inputs will be listed here -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
      <div class="setting-group">
        <h3>Rendering</h3>
        <div class="setting-item">
          <label for="clear-color">Clear Color (Background)</label>
          <div class="color-picker-wrapper">
            <input type="color" id="clear-color" value="#1a1a1a">
            <span id="clear-color-hex">#1a1a1a</span>
          </div>
        </div>
        <div class="setting-item">
          <label for="resolution-scale">Resolution Scale</label>
          <select id="resolution-scale">
            <option value="0.25">0.25x (Performance)</option>
            <option value="0.5">0.5x (Balanced)</option>
            <option value="1.0" selected>1.0x (Native)</option>
            <option value="2.0">2.0x (High DPI)</option>
          </select>
        </div>
      </div>
  
      <div class="setting-group">
        <h3>Editor</h3>
        <div class="setting-item">
          <label for="font-size">Font Size (px)</label>
          <input type="number" id="font-size" value="13" min="10" max="24">
        </div>
        <div class="setting-item">
          <label for="word-wrap" class="checkbox-label">
            <span>Word Wrap</span>
            <input type="checkbox" id="word-wrap">
          </label>
        </div>
      </div>

      <div class="setting-group">
        <h3>Display</h3>
        <div class="setting-item">
          <label for="show-fps" class="checkbox-label">
            <span>Show FPS Counter</span>
            <input type="checkbox" id="show-fps">
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- CodeMirror Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/mode/simple.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/rust/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/selection/active-line.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/comment/comment.min.js"></script>

  <!-- Main Application Script -->
  <script src="main.js" type="module"></script>
</body>

</html>